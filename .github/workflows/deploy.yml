name: CI/CD - Deploy Resume

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆCIï¼‰
  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Check HTML syntax
      run: |
        echo "âœ… Checking HTML files..."
        # ç®€å•æ£€æŸ¥ HTML æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if [ -f "index.html" ]; then
          echo "âœ… index.html found"
        else
          echo "âŒ index.html not found"
          exit 1
        fi
    
    - name: Check CSS syntax
      run: |
        echo "âœ… Checking CSS files..."
        if [ -f "style.css" ]; then
          echo "âœ… style.css found"
        else
          echo "âŒ style.css not found"
          exit 1
        fi
    
    - name: Check JavaScript syntax
      run: |
        echo "âœ… Checking JavaScript files..."
        if [ -f "script.js" ]; then
          echo "âœ… script.js found"
        else
          echo "âŒ script.js not found"
          exit 1
        fi

  # Job 2: æ„å»ºå’Œéƒ¨ç½²ï¼ˆCDï¼‰
  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: lint  # åªæœ‰ lint é€šè¿‡åæ‰éƒ¨ç½²
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup deployment
      run: |
        echo "ğŸš€ Preparing deployment..."
        echo "ğŸ“¦ Project: Jade Resume"
        echo "ğŸŒ Target: GitHub Pages"
        echo "âœ… All checks passed!"
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: .
        publish_branch: gh-pages
    
    - name: Deployment success
      run: |
        echo "âœ… Deployment successful!"
        echo "ğŸŒ Your site is live at: https://jadejesse.github.io/Jade_resume/"
        echo "â° Deployed at: $(date)"

  # Job 3: é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
  notify:
    name: Send Notification
    runs-on: ubuntu-latest
    needs: deploy
    if: always()
    
    steps:
    - name: Notify deployment status
      run: |
        if [ "${{ needs.deploy.result }}" == "success" ]; then
          echo "âœ… éƒ¨ç½²æˆåŠŸé€šçŸ¥"
          echo "ğŸ“§ å¯ä»¥åœ¨è¿™é‡Œé›†æˆ Slack/Email é€šçŸ¥"
        else
          echo "âŒ éƒ¨ç½²å¤±è´¥é€šçŸ¥"
        fi
